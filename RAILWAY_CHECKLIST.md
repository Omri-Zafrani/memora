# Railway Deployment Checklist for Memora with User Profiles

## Pre-Deployment Setup âœ…

### 1. Repository Preparation
- [ ] Code pushed to GitHub repository
- [ ] All user profile files included:
  - [ ] `app/models/user_profile.py`
  - [ ] `app/db/user_profile_models.py`
  - [ ] `app/services/user_profile_service.py`
  - [ ] `app/api/user_profile.py`
  - [ ] `app/db/migrations/add_user_profiles.py`
  - [ ] `telegram_bot_enhanced.py`
  - [ ] `run_migration.py`

### 2. Dependencies & Configuration
- [ ] `requirements.txt` includes:
  - [ ] `pydantic==2.5.0`
  - [ ] `typing-extensions==4.8.0`
  - [ ] All existing dependencies
- [ ] `Dockerfile` updated with `USER_PROFILES_ENABLED=true`
- [ ] `railway.toml` configuration file present
- [ ] `start_railway.py` uses enhanced Telegram bot

### 3. API Integration
- [ ] `app/main.py` includes user profile router
- [ ] Auto-migration on startup configured
- [ ] Import error handling for profile system

## Railway Deployment Steps âœ…

### 1. Create Railway Project
- [ ] Fork repository to your GitHub account
- [ ] Connect GitHub repository to Railway
- [ ] Railway detects Dockerfile automatically

### 2. Environment Variables
**Required:**
- [ ] `TELEGRAM_BOT_TOKEN` = `your_bot_token_here`
- [ ] `OPENAI_API_KEY` = `your_openai_key_here`

**Auto-Generated by Railway:**
- [ ] `DATABASE_URL` (PostgreSQL connection)
- [ ] `PORT` (Application port)
- [ ] `RAILWAY_ENVIRONMENT=production`

**Optional (with defaults):**
- [ ] `USER_PROFILES_ENABLED=true`
- [ ] `PYTHONPATH=/app`

### 3. Database Setup
- [ ] PostgreSQL service auto-created by Railway
- [ ] No manual database setup required
- [ ] Migration runs automatically on first deployment

## Post-Deployment Verification âœ…

### 1. Basic Health Checks
- [ ] Visit `https://your-app.railway.app/health`
  - Should return: `{"status": "healthy"}`
- [ ] Visit `https://your-app.railway.app/health/detailed`
  - Check `"user_profiles_available": true`
  - Check `"migration_status": "completed"`

### 2. API Endpoints Test
**Core API:**
- [ ] `POST /extract` - Content extraction
- [ ] `POST /search` - Semantic search
- [ ] `GET /user/{user_id}/stats` - User statistics

**User Profile API:**
- [ ] `GET /api/profiles/{user_id}` - Get profile
- [ ] `POST /api/profiles/telegram` - Create from Telegram
- [ ] `GET /api/profiles/{user_id}/stats` - Profile stats

### 3. Telegram Bot Test
- [ ] Bot responds to `/start` command
- [ ] Enhanced welcome message with profile features
- [ ] `/profile` command shows user information
- [ ] `/stats` command shows enhanced statistics
- [ ] Message processing works (save/search detection)
- [ ] Activity tracking works (visible in `/stats`)

### 4. Database Verification
**Check tables created:**
- [ ] `user_profiles` table exists
- [ ] `user_auth_providers` table exists  
- [ ] `user_activity` table exists
- [ ] Existing `users` and `items` tables intact

**Test data flow:**
- [ ] New users get profiles automatically
- [ ] Activity tracking records interactions
- [ ] Profile data persists across restarts

## Troubleshooting Checklist ðŸ”§

### If Deployment Fails
- [ ] Check Railway build logs for errors
- [ ] Verify all files are committed to Git
- [ ] Ensure no syntax errors in Python files
- [ ] Check Dockerfile builds successfully

### If Health Check Fails
- [ ] Check application logs in Railway dashboard
- [ ] Verify DATABASE_URL is set correctly
- [ ] Check for import errors in user profile modules
- [ ] Verify FastAPI starts successfully

### If Migration Fails
- [ ] Check database connection in logs
- [ ] Verify PostgreSQL service is running
- [ ] Check migration logs for specific errors
- [ ] Ensure database user has proper permissions

### If Bot Doesn't Respond
- [ ] Verify TELEGRAM_BOT_TOKEN is correct
- [ ] Check bot process starts in logs
- [ ] Ensure backend URL detection works
- [ ] Test webhook connectivity

### If User Profiles Don't Work
- [ ] Check `USER_PROFILES_AVAILABLE=true` in health endpoint
- [ ] Verify profile service imports work
- [ ] Check database tables were created
- [ ] Test profile creation manually via API

## Performance Optimization âš¡

### Railway Configuration
- [ ] Health check timeout set to 30 seconds
- [ ] Restart policy configured for failures
- [ ] Resource limits appropriate for usage

### Database Optimization
- [ ] Connection pooling enabled
- [ ] Indexes created by migration
- [ ] Query optimization in place

### Application Optimization
- [ ] Async/await patterns used
- [ ] Error handling doesn't block operations
- [ ] Logging configured appropriately

## Security Verification ðŸ”’

### Environment Security
- [ ] Secrets stored as environment variables (not in code)
- [ ] API keys not exposed in logs
- [ ] Database connection encrypted

### User Data Protection
- [ ] User data isolated by user_id
- [ ] Profile data properly validated
- [ ] Activity tracking doesn't store sensitive data

### API Security
- [ ] Input validation on all endpoints
- [ ] Error messages don't leak internal details
- [ ] Rate limiting considerations

## Monitoring Setup ðŸ“Š

### Health Monitoring
- [ ] Railway health checks enabled
- [ ] Custom health endpoints configured
- [ ] Log aggregation setup

### User Analytics
- [ ] Activity tracking functional
- [ ] User statistics accessible
- [ ] Profile data insights available

### Performance Monitoring
- [ ] Resource usage tracking
- [ ] Database performance monitoring
- [ ] Response time monitoring

## Go-Live Checklist ðŸš€

### Final Steps
- [ ] All tests passing
- [ ] User acceptance testing completed
- [ ] Documentation updated
- [ ] Support processes in place

### Post-Launch
- [ ] Monitor logs for first 24 hours
- [ ] Verify user profile creation works
- [ ] Check activity tracking data
- [ ] Monitor performance metrics

---

## Quick Commands for Verification

```bash
# Health checks
curl https://your-app.railway.app/health
curl https://your-app.railway.app/health/detailed

# Test profile API
curl https://your-app.railway.app/api/profiles/health

# Check logs
railway logs --follow

# Monitor database
railway connect postgres
```

---

âœ… **Deployment Complete!** Your Memora with User Profiles is ready on Railway. 